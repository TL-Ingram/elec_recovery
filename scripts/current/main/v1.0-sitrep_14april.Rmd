---
date: "`r Sys.Date()`"
title: "Situation Report - Elective care recovery modelling (Inpatient)"
subtitle: "v1.0.1"
author: "WWL DAA: Data Science"
output: pdf_document
---

# ```{r setup, include=F}
# library(here)
# source(here("scripts", "current", "main", "v2.2-rmarkdown.R"), 
#        local = knitr::knit_global())
# ```

---
``` {r test, echo = F, warning = F, message = F}
library(here)
library(tidyverse)
library(readr)
plot_lw <- read_rds(here("rds", "test.rds"))
plot_lw_2 <- plot_lw %>%
  ggplot() +
  facet_wrap(speciality ~ ., scales = "free_y", ncol = 4) +
  geom_line(aes(date, patients, colour = wl), alpha = 0.8, size = 0.2, 
            data = plot_lw %>% 
              filter(wl %in% c(">52 weeks", 
                               ">65 weeks"))) + 
  geom_line(aes(date, p_mean, colour = wl), alpha = 0.8, size = 0.2, 
            data = plot_lw %>% 
              filter(wl %in% c(">52 weeks", 
                               ">65 weeks"),
                     .model == "paramatised")) +
  geom_ribbon(aes(date, ymax = upper, ymin = lower),
              fill="slategray3", alpha=.3,
              data = plot_lw %>% filter(wl %in% ">52 weeks")) +
  geom_ribbon(aes(date, ymax = upper, ymin = lower),
              fill="slategray3", alpha=.3,
              data = plot_lw %>% filter(wl %in% ">65 weeks")) +
  scale_x_date(breaks = "3 months", date_labels = "%b-%Y") +
  theme_bw() +
  theme(strip.text.x = element_text(size = 6),
        strip.background = element_rect(fill="grey95"),
        plot.caption = element_text(size = 6),
        legend.position = "bottom",
        axis.text.y = element_text(size = 5),
        axis.text.x = element_text(size = 5, angle = 90, vjust = 0.5)) +
  scale_colour_manual(values = c("steelblue", "indianred4")) +
  labs(fill = "",
       x = "",
       y = "Patients",
       subtitle = "Long waiters forecast",
       level = "",
       colour = "",
       caption = "Specialities shown are those that have >5 long waiters at horizon start date")
plot_lw_2

```